$(function(){$("#buat-job").click(function(a){a.preventDefault(),Swal.fire({title:"Backup Inkremental",text:"Backup Inkremental membutuhkan resource yang besar dan membuat akses ke aplikasi menjadi lambat. Disarankan menjalankan backup Inkremental disaat aplikasi tidak di akses.",footer:'<div class="text-bold text-center text-red">Backup Inkremental akan berjalan di belakang layar dan tidak bisa dibatalkan sampai proses selesai</div>',icon:"warning",showCancelButton:!0,confirmButtonText:"Lanjutkan"}).then(a=>{a.isConfirmed&&Swal.fire({title:"Lokasi Simpan",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Temporary folder",denyButtonText:"Backup folder",footer:`
                        <div class="text-bold text-warning">
                            <ul>
                                <li>Temporary folder : file backup akan terhapus otomatis oleh sistem</li>
                                <li>folder backup : file backup akan disimpan di dalam folder backup_inkremental dan tidak akan dihapus oleh sistem. </li>
                            </ul>
                        </div>
                        `}).then(a=>{if(a.isConfirmed)e("null");else{if(!a.isDenied)return;e("backup")}})})});var e=function(e){notification("success","Backup Sedang Dalam Proses"),$("#Inkremental").html('<i class="fa fa-download"></i> Backup Dalam Proses').addClass("btn-warning"),$("button.dropdown-toggle").addClass("btn-warning"),$("#Inkremental").parent().find("ul").append("<li><a href=\"<?= site_url('database/batal_backup'); ?>\">Batalkan Proses Backup</a></li>"),$.ajax({url:SITE_URL+"database/inkremental_job",type:"Post",data:{lokasi:e}}).done(function(e){!0==e.status?$("#buat-job").remove():(notification("danger",e.message),$("#Inkremental").html('<i class="fa fa-download"></i> Backup Dalam Proses').removeClass("btn-warning"),$("button.dropdown-toggle").removeClass("btn-warning"))}).fail(function(e){notification("danger",e)})};$("#restore-desa").click(function(e){Swal.fire({title:"Kirim Kode Verifikasi",showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Email",cancelButtonText:"Tutup",denyButtonText:"Telegram",footer:'<div class="text-bold text-warning">Kode Verifikasi hanya berlaku 5 menit</div>'}).then(e=>{e.isConfirmed?(Swal.fire({title:"Mengirim Kode Verifikasi Email",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen(){Swal.showLoading()}}),$.ajax({url:SITE_URL+"database/kirim_otp",type:"POST",data:{sidcsrf:getCsrfToken(),method:"email"}}).done(function(){a()}).fail(function(e){Swal.fire({icon:"error",title:"Oops...",text:`${e?.responseJSON?.message}`})})):e.isDenied&&(Swal.fire({title:"Mengirim Kode Verifikasi Telegram",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen(){Swal.showLoading()}}),$.ajax({url:SITE_URL+"database/kirim_otp",type:"POST",data:{sidcsrf:getCsrfToken(),method:"telegram"}}).done(function(){a()}).fail(function(e){Swal.fire({icon:"error",title:"Oops...",text:`${e?.responseJSON?.message}`})}))})});var a=function(){Swal.fire({title:"Masukan Kode Verifikasi",input:"text",inputPlaceholder:"Masukan Kode Verifikasi",inputValidator(e){if(isNaN(e))return"Kode Verifikasi harus berupa angka"},showCancelButton:!0,confirmButtonText:"Kirim",cancelButtonText:"Tutup",showLoaderOnConfirm:!0,preConfirm(e){let a=new FormData;return a.append("sidcsrf",getCsrfToken()),a.append("otp",e),fetch(SITE_URL+"database/verifikasi_otp",{method:"POST",body:a}).then(e=>{if(!e.ok)throw Error(e.statusText);return e.json()}).catch(e=>{Swal.showValidationMessage(`Request failed: ${e}`)})}}).then(e=>{e.isConfirmed&&(!0==e.value.status?t():Swal.fire({icon:"error",title:e.value.message}))})},t=function(){let e=new FormData;e.append("sidcsrf",getCsrfToken()),e.append("file",$("#file1")[0].files[0]),Swal.fire({title:"Sedang mengunggah file",html:"Progress : <b></b>%",timerProgressBar:!0,didOpen(){Swal.showLoading();let a=Swal.getHtmlContainer().querySelector("b");$.ajax({xhr:function(){var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;t=parseInt(100*t),a.textContent=t}},!1),e},url:SITE_URL+"database/upload_restore",type:"POST",data:e,processData:!1,contentType:!1,success:function(e){!0==e.status?Swal.fire({title:"Proses restore",html:"Proses restore dilakukan melalui job background."}).then(function(){window.location=SITE_URL+"database"}):Swal.fire({title:"Proses restore gagal",icon:"error",html:e.messages})}}).fail(function(e){e.responseText,Swal.fire({title:"Proses upload gagal",icon:"warning",html:e.responseText})})}})}});